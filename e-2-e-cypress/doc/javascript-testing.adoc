= JavaScript Testing and Code Quality
:toc: left
:toclevels: 3
:toc-title: Table of Contents
:sectnums:
:source-highlighter: highlight.js

== Purpose

This guide covers JavaScript code quality and E2E testing implementation for the NiFi Extensions project, focusing on ESLint standards compliance, Prettier formatting, and Cypress testing patterns.

== Overview

The JavaScript testing infrastructure provides comprehensive E2E testing capabilities with strict code quality enforcement through ESLint and Prettier, ensuring robust functionality and maintainable code.

== Code Quality Framework

=== ESLint Configuration

The project implements strict ESLint standards with zero-warning enforcement:

[source,javascript]
----
// .eslintrc.js
module.exports = {
  env: {
    browser: true,
    es2021: true,
    node: true,
    'cypress/globals': true
  },
  extends: [
    'eslint:recommended',
    'plugin:cypress/recommended',
    'plugin:security/recommended-legacy',
    'plugin:sonarjs/recommended',
    'plugin:unicorn/recommended',
    'plugin:jsdoc/recommended',
    'plugin:prettier/recommended'
  ],
  plugins: [
    'cypress',
    'security',
    'sonarjs',
    'unicorn',
    'jsdoc',
    'prettier'
  ],
  rules: {
    // Security Rules
    'security/detect-object-injection': 'error',
    'security/detect-non-literal-regexp': 'error',
    'security/detect-eval-with-expression': 'error',
    
    // Code Quality Rules
    'sonarjs/cognitive-complexity': ['error', 15],
    'sonarjs/no-duplicate-string': ['error', 3],
    'unicorn/prevent-abbreviations': 'error',
    
    // Documentation Rules
    'jsdoc/require-description': 'error',
    'jsdoc/require-param-description': 'error',
    'jsdoc/require-returns-description': 'error'
  }
};
----

=== Available npm Scripts

The project provides these quality assurance scripts:

[source,bash]
----
# Linting
npm run lint              # Check for linting issues
npm run lint:fix          # Auto-fix linting issues
npm run lint:check        # Check with zero-warning enforcement
npm run lint:strict       # Strict mode with unused disable directives

# Code Formatting
npm run format            # Format code with Prettier
npm run format:check      # Check formatting without changes

# Testing
npm run cypress:run       # Run all Cypress tests headlessly
npm run cypress:open      # Open Cypress UI for interactive testing
npm run test:failfast     # Run tests with fail-fast behavior

# Analysis
npm run analyze:console   # Analyze console errors from test runs
npm run analyze:logs      # Enhanced log analysis with verbose output
----

== Cypress E2E Testing

=== Test Structure

[source,javascript]
----
// cypress/e2e/example.cy.js
describe('Component Test Suite', () => {
  beforeEach(() => {
    cy.visit('/nifi');
    cy.authenticateUser();
  });

  /**
   * Tests component functionality
   * @test {string} testId - Unique test identifier
   */
  it('should validate component behavior', () => {
    // Test implementation
    cy.get('[data-testid="component"]')
      .should('be.visible')
      .click();
      
    cy.verifyComponentState();
  });
});
----

=== Helper Functions and Constants

[source,javascript]
----
// cypress/support/constants.js
export const SELECTORS = {
  LOGIN_FORM: '[data-testid="login-form"]',
  USERNAME_INPUT: '[data-testid="username-input"]',
  PASSWORD_INPUT: '[data-testid="password-input"]',
  SUBMIT_BUTTON: '[data-testid="submit-button"]'
};

export const TEST_DATA = {
  VALID_USER: {
    username: 'admin',
    password: 'password123'
  }
};

// cypress/support/auth-helper.js
/**
 * Authenticates user with provided credentials
 * @param {Object} credentials - User credentials
 * @param {string} credentials.username - Username
 * @param {string} credentials.password - Password
 */
export function authenticateUser(credentials = TEST_DATA.VALID_USER) {
  cy.get(SELECTORS.USERNAME_INPUT).type(credentials.username);
  cy.get(SELECTORS.PASSWORD_INPUT).type(credentials.password);
  cy.get(SELECTORS.SUBMIT_BUTTON).click();
}
----

== Testing Requirements

=== Coverage Standards

Based on the project's quality standards:

* **Code Quality**: Zero ESLint warnings enforced
* **Formatting**: Consistent Prettier formatting across all files
* **Documentation**: JSDoc comments required for all functions
* **Security**: Security plugin rules enforced
* **Cypress Tests**: Comprehensive E2E coverage for user workflows

=== Security Testing Patterns

[source,javascript]
----
// Security-focused test patterns
describe('Security Validation', () => {
  it('should prevent XSS injection', () => {
    const maliciousInput = '<script>alert("xss")</script>';
    
    cy.get('[data-testid="input-field"]')
      .type(maliciousInput);
      
    cy.get('[data-testid="output"]')
      .should('not.contain', '<script>')
      .should('contain', '&lt;script&gt;');
  });

  it('should validate authentication tokens', () => {
    cy.intercept('POST', '/api/auth', { fixture: 'auth-response.json' });
    
    cy.authenticateUser();
    cy.get('@authRequest').should('have.property', 'headers')
      .and('include', { 'Authorization': 'Bearer' });
  });
});
----

== Development Workflow

=== Code Quality Checks

[source,bash]
----
# Before committing code
npm run lint:fix          # Fix auto-fixable issues
npm run format            # Format code consistently
npm run lint:check        # Verify zero warnings
npm run cypress:run       # Run full test suite
----

=== CI/CD Integration

[source,yaml]
----
# Example CI pipeline step
- name: Quality Checks
  run: |
    npm ci
    npm run lint:check
    npm run format:check
    npm run cypress:run
----

== Tool Integration

=== IDE Configuration

**VS Code Settings** (`.vscode/settings.json`):
[source,json]
----
{
  "eslint.enable": true,
  "eslint.format.enable": true,
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  },
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "editor.formatOnSave": true
}
----

=== Maven Integration

The Maven build process enforces code quality:

[source,xml]
----
<plugin>
  <groupId>com.github.eirslett</groupId>
  <artifactId>frontend-maven-plugin</artifactId>
  <executions>
    <execution>
      <id>npm-lint-check</id>
      <goals>
        <goal>npm</goal>
      </goals>
      <configuration>
        <arguments>run lint:check</arguments>
      </configuration>
    </execution>
  </executions>
</plugin>
----

== Best Practices

=== Code Standards

1. **JSDoc Documentation**: All functions must have comprehensive JSDoc comments
2. **Error Handling**: Implement proper error boundaries and logging
3. **Security**: Follow security plugin recommendations
4. **Performance**: Optimize selectors and reduce cognitive complexity
5. **Maintainability**: Use constants for selectors and test data

=== Testing Guidelines

1. **Test Organization**: Group related tests in describe blocks
2. **Data Management**: Use fixtures for test data
3. **Page Objects**: Implement reusable page object patterns
4. **Assertions**: Use meaningful assertion messages
5. **Cleanup**: Ensure proper test isolation and cleanup

== Standards References

