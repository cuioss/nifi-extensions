= NiFi UI Structure
:toc: left
:toclevels: 3
:sectnums:
:icons: font
:source-highlighter: highlight.js

== NiFi 2.4.0 UI Sources

**Current Version**: Apache NiFi 2.4.0

**UI Sources Access**: For comprehensive AI analysis and development, the NiFi 2.4.0 UI sources are available via:

**GitIngest URL**: https://gitingest.com/apache/nifi/tree/rel/nifi-2.4.0/nifi-web/nifi-web-ui

This provides direct access to the complete Angular Material-based UI implementation for automated analysis and development workflows.

== What is the NiFi UI Like

Apache NiFi's user interface is a modern Angular Material-based Single Page Application (SPA) with SVG-based canvas for flow diagram visualization. **VERIFIED BY SOURCE CODE ANALYSIS**: NiFi 2.4.0 uses Angular 19.2.14 with Angular Material 19.2.14, built as an Nx monorepo with TypeScript, and features a sophisticated component architecture with NgRx state management.

== Framework and Architecture

=== Verified Technology Stack (Source Code Analysis)
* **Framework**: Angular 19.2.14 with Angular Material 19.2.14
* **Architecture**: Nx monorepo with multiple applications (nifi, nifi-jolt-transform-ui, standard-content-viewer, update-attribute)
* **State Management**: NgRx 19.0.1 (store, effects, router-store, store-devtools)
* **Styling**: Tailwind CSS + Angular Material + SCSS
* **Root Component**: `<nifi></nifi>` with `mat-app-background mat-typography` classes
* **Canvas**: D3.js 7.8.5 for data visualization within Angular Material containers
* **Build System**: Nx workspace with Jest testing and ESLint
* **Additional Libraries**: CodeMirror, Clipboard.js, Marked (Markdown), PrismJS (syntax highlighting)

=== Authentication System
* **Login URL**: `https://localhost:9095/nifi/#/login`
* **Form Type**: Angular Material login form with Material Design components
* **Navigation**: Angular SPA routing system with hash-based URLs
* **Integration**: Keycloak OAuth integration for authentication

== Source Code Structure

=== Repository Organization
The NiFi UI source code is located at:
```
nifi-frontend/src/main/frontend/
├── apps/
│   ├── nifi/                    # Main NiFi application
│   ├── nifi-jolt-transform-ui/  # Jolt transformation UI
│   ├── standard-content-viewer/ # Content viewer
│   └── update-attribute/        # Update attribute processor UI
├── libs/                        # Shared libraries
├── package.json                 # Dependencies (Angular 19.2.14, Material 19.2.14)
├── nx.json                      # Nx workspace configuration
└── tsconfig.base.json          # TypeScript configuration
```

=== Main Application Structure
The core NiFi application (`apps/nifi/src/app/`) follows Angular best practices:
```
app/
├── pages/
│   ├── flow-designer/           # Main canvas and flow design
│   │   └── ui/canvas/          # Canvas component with mat-sidenav-content
│   ├── login/                   # Authentication pages
│   ├── settings/                # Configuration pages
│   ├── users/                   # User management
│   └── [other pages]/
├── service/                     # Angular services
├── state/                       # NgRx state management
├── ui/                          # Shared UI components
├── app.component.html           # Root template with router-outlet
└── app-routing.module.ts        # Application routing
```

=== Key Component Files
* **Root Component**: `apps/nifi/src/index.html` - Contains `<nifi></nifi>` with `mat-app-background`
* **Canvas Component**: `pages/flow-designer/ui/canvas/canvas.component.html` - Main canvas with `#canvas-container`
* **App Component**: `app.component.html` - Router outlet with mat-spinner loading
* **Package Dependencies**: `package.json` - Angular Material 19.2.14, D3.js 7.8.5, NgRx 19.0.1

== DOM Structure

=== Actual DOM Structure (From Source Code Analysis)
Based on source code analysis of `canvas.component.html` and `index.html`, NiFi UI follows this Angular Material structure:

[source,html]
----
<body class="mat-app-background mat-typography text-base">
  <nifi>
    <router-outlet>
      <!-- Flow Designer Canvas Component -->
      <div class="flex flex-col h-full">
        <fd-header></fd-header>
        <div class="flex-1">
          <mat-sidenav-container class="h-full">
            <mat-sidenav mode="side" position="end">
              <flow-analysis-drawer></flow-analysis-drawer>
            </mat-sidenav>
            <mat-sidenav-content>
              <graph-controls></graph-controls>
              <div id="canvas-container" 
                   class="canvas-background select-none h-full w-full">
                <!-- D3.js canvas content rendered here -->
              </div>
            </mat-sidenav-content>
          </mat-sidenav-container>
        </div>
        <fd-footer></fd-footer>
      </div>
    </router-outlet>
  </nifi>
</body>
----

=== Key UI Components

==== Canvas Area
* **Container**: Uses `#canvas-container` or `.canvas-container` classes
* **Canvas SVG**: `#canvas` or `svg[id*="canvas"]` selectors
* **Drawing Surface**: SVG-based canvas for flow diagram visualization

==== Toolbar
* **Main Toolbar**: Uses `#nf-header` or `.nf-header` classes
* **Buttons**: Standard button elements with title/aria-label attributes

==== Dialogs
* **Dialog Container**: Uses `.dialog`, `[role="dialog"]`, or `.modal` classes
* **Add Processor Dialog**: Standard modal dialogs for processor configuration

== Selector Patterns

=== Verified Selectors (From Source Code Analysis)
These selectors are confirmed by source code analysis of NiFi 2.4.0:

[source,javascript]
----
// Canvas operations (from canvas.component.html)
CANVAS_CONTAINER: '#canvas-container'                    // Primary canvas container
CANVAS_SIDENAV: 'mat-sidenav-content'                   // Angular Material container
CANVAS_SIDENAV_CONTAINER: 'mat-sidenav-container'       // Full sidenav layout

// Component selectors (from source code structure)
HEADER: 'fd-header'                                      // Flow designer header
FOOTER: 'fd-footer'                                      // Flow designer footer
GRAPH_CONTROLS: 'graph-controls'                        // Canvas controls
FLOW_ANALYSIS_DRAWER: 'flow-analysis-drawer'            // Side panel

// Angular Material components (confirmed in package.json)
MAT_SPINNER: 'mat-spinner'                              // Loading spinner
MAT_SIDENAV: 'mat-sidenav'                              // Side navigation
ROUTER_OUTLET: 'router-outlet'                          // Angular routing

// Root application (from index.html)
ROOT_COMPONENT: 'nifi'                                  // Main application component
BODY_CLASSES: '.mat-app-background.mat-typography'      // Body styling classes
----

=== Verified Angular Material Selectors
**CURL ANALYSIS CONFIRMS**: These Angular Material selectors DO work with NiFi 2.4.0:

[source,css]
----
mat-sidenav-content
.mat-drawer-content
mat-toolbar
mat-dialog-container
----

*Verification Results (from actual NiFi HTML):*
* Angular Material CSS classes: `mat-app-background mat-typography` found in body
* Material Design CSS variables: `--mat-sys-*`, `--mdc-*`, `--mat-sidenav-*` extensively used
* Angular component: `<nifi></nifi>` root component confirmed
* SPA architecture: ES modules with `type="module"` scripts

== Cypress Testing Best Practices

=== Progressive Enhancement Strategy
Use multiple selector strategies for robustness:

[source,javascript]
----
// Try multiple selector strategies
function findCanvas() {
  const selectors = [
    '#canvas',
    'svg[id*="canvas"]', 
    '.canvas svg',
    'svg',
    '[role="img"]'
  ];

  for (const selector of selectors) {
    const element = Cypress.$(selector);
    if (element.length > 0) {
      return selector;
    }
  }
  throw new Error('Canvas not found with any selector');
}
----

=== Wait Strategies
NiFi UI loads asynchronously, so use proper waits:

[source,javascript]
----
// Wait for canvas to be ready
cy.get('svg', { timeout: 15000 }).should('be.visible')
cy.get('svg').should('have.attr', 'width')
cy.get('svg').should('have.attr', 'height')
----

=== Interaction Patterns
NiFi uses specific interaction patterns:

[source,javascript]
----
// Right-click for context menu
cy.get('svg').rightclick(400, 300)

// Double-click to add processor
cy.get('svg').dblclick(400, 300)

// Drag and drop for connections
cy.get('.processor').trigger('mousedown')
cy.get('svg').trigger('mousemove', { clientX: 500, clientY: 400 })
cy.get('svg').trigger('mouseup')
----

=== Error Handling
Robust element finding with fallbacks:

[source,javascript]
----
// Robust element finding
cy.get('body').then(($body) => {
  if ($body.find('#canvas').length > 0) {
    // Use #canvas
  } else if ($body.find('svg').length > 0) {
    // Use svg fallback
  } else {
    throw new Error('No canvas found');
  }
});
----

== UI Characteristics

=== Angular Material Architecture
* **Material Design Components**: UI built with Angular Material components and Material Design CSS
* **Component-Based Selectors**: Reliable Angular Material selectors (`mat-*` classes)
* **SVG Canvas**: Flow diagram rendered in SVG within Angular Material containers

=== Navigation Model
* **Hash-Based URLs**: URLs use hash-based routing (e.g., `#/login`)
* **Angular SPA Navigation**: Single Page Application routing patterns
* **Material Layout**: Angular Material layout system with sidenav containers

=== Visual Design
* **Custom Styling**: Custom CSS styling for NiFi-specific appearance
* **Dark Theme**: Default dark mode appearance
* **Responsive Elements**: Canvas and UI elements adapt to screen size

== Source Code Analysis Summary

=== Comprehensive Findings
Through direct analysis of the NiFi 2.4.0 source code at `nifi-frontend/src/main/frontend/`, we have confirmed:

1. **Modern Angular Architecture**: Angular 19.2.14 with Angular Material 19.2.14 in an Nx monorepo
2. **Sophisticated State Management**: NgRx 19.0.1 for application state with effects and router integration
3. **Advanced Styling**: Combination of Tailwind CSS, Angular Material, and SCSS for comprehensive theming
4. **Multiple Applications**: Modular architecture with separate apps for different UI components
5. **D3.js Integration**: D3.js 7.8.5 for advanced data visualization within Angular Material containers

=== Key Component Structure
* **Root**: `<nifi></nifi>` component with `mat-app-background mat-typography` classes
* **Routing**: Angular router with `<router-outlet>` for SPA navigation
* **Canvas**: `#canvas-container` within `mat-sidenav-content` for the main flow design area
* **Layout**: Flexbox layout with `fd-header`, `mat-sidenav-container`, and `fd-footer`
* **Controls**: `graph-controls` and `flow-analysis-drawer` for canvas interaction

=== Testing Strategy Implications
* **Use Verified Selectors**: `#canvas-container`, `mat-sidenav-content`, `fd-header`, `graph-controls`
* **Angular Material Patterns**: Leverage `mat-spinner`, `mat-sidenav`, and Material Design components
* **Component-Based Testing**: Target specific Angular components rather than generic DOM elements
* **State-Aware Testing**: Consider NgRx state management in test scenarios
* **Multi-App Architecture**: Tests may need to handle different applications within the monorepo
