= D1. Replace jQuery UI Tooltip with Tippy.js
:toc:
:toclevels: 4

[ ] *Priority:* High

*Description:* Replace jQuery UI's tooltip functionality with Tippy.js, a lightweight and flexible tooltip library powered by Popper.js. This will reduce bundle size while maintaining essential tooltip features.

*Rationale:* jQuery UI adds unnecessary weight to our bundle. Replacing just the tooltip functionality with a dedicated library will significantly reduce bundle size while maintaining the required tooltip features.

== Task Details

=== Context and Problem Statement

Our application currently uses jQuery UI's tooltip functionality, which adds unnecessary weight to our bundle. The tooltip implementation has custom positioning options that need to be maintained in any replacement solution.

=== Chosen Solution: Tippy.js

* Extremely customizable positioning (similar to jQuery UI's options)
* Small size: ~22.5KB minified (core + CSS)
* Wide range of features including custom positioning, themes, animations
* TypeScript support
* Well-documented with extensive examples
* Modern API with excellent browser support
* Active community and maintenance

=== Implementation Plan

1. [ ] Install Tippy.js and its dependencies:
+
[source,bash]
----
npm install tippy.js @popperjs/core
----

2. [ ] Create a Tooltip Utility Module:
+
[source,javascript]
----
// utils/tooltip.js
import tippy from 'tippy.js';
import 'tippy.js/dist/tippy.css';
import 'tippy.js/themes/light-border.css'; // Optional for jQuery UI-like styling

export function initTooltips(selector, options = {}, context = document) {
  const elements = typeof selector === 'string' 
    ? context.querySelectorAll(selector) 
    : (Array.isArray(selector) ? selector : [selector]);
  
  if (elements.length === 0) return null;
  
  // Default options similar to our jQuery UI tooltip config
  const defaultOptions = {
    placement: 'bottom-start', // Similar to our jQuery UI positioning
    arrow: true,
    theme: 'light-border',
    appendTo: 'parent', // Attaches tooltip to parent instead of document.body
  };
  
  // Merge default options with provided options
  const tippyOptions = { ...defaultOptions, ...options };
  
  try {
    return tippy(Array.from(elements), tippyOptions);
  } catch (error) {
    console.error('Error initializing tooltips:', error);
    // Fallback to title attribute if tooltip function fails
    Array.from(elements).forEach(element => {
      const title = element.getAttribute('title');
      if (title) {
        element.setAttribute('data-original-title', title);
      }
    });
    return null;
  }
}
----

3. [ ] Update main.js to use the new tooltip utility:
+
[source,javascript]
----
import { initTooltips } from './utils/tooltip';

// Replace jQuery UI tooltip initialization with Tippy.js
try {
  const tooltipSelector = '.help-tooltip';
  initTooltips(contextElement ? `${tooltipSelector}`, {
    // Map jQuery UI positioning options to Tippy.js options
    placement: 'bottom-start' // Equivalent to 'my: left top+5, at: left bottom'
  }, contextElement || document);
} catch (error) {
  console.error('Error initializing tooltips:', error);
}
----

4. [ ] Create test mock for Tippy.js:
+
[source,javascript]
----
// mocks/tippy.js
const mockTippy = jest.fn().mockImplementation((targets, options) => {
  // Handle both array and single element
  const elements = Array.isArray(targets) ? targets : [targets];
  
  // Record tooltip initialization on elements
  elements.forEach(element => {
    element._tippyOptions = options;
    element.setAttribute('data-tippy-initialized', 'true');
  });
  
  // Return mock instance API
  return {
    setProps: jest.fn(),
    destroy: jest.fn(),
    setContent: jest.fn(),
    show: jest.fn(),
    hide: jest.fn(),
  };
});

// For the test that checks if tooltip functionality is available
mockTippy.isSupported = true;

export default mockTippy;
----

== References

* https://atomiks.github.io/tippyjs/[Tippy.js Documentation]
* https://popper.js.org/[Popper.js Documentation]
