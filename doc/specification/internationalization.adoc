= MultiIssuerJWTTokenAuthenticator Internationalization
:toc:
:toclevels: 3
:toc-title: Table of Contents
:sectnums:

link:../Specification.adoc[Back to Main Specification]

== Internationalization Overview
_See Requirement link:../Requirements.adoc#NIFI-AUTH-17[NIFI-AUTH-17: Internationalization Support]_

The MultiIssuerJWTTokenAuthenticator implements comprehensive internationalization (i18n) support for all user-facing content, with initial support for English and German languages. This document outlines the internationalization approach, resource bundle structure, and implementation details.

== Implementation Status

=== Implementation Classes
* link:../../nifi-cuioss-common/src/main/java/de/cuioss/nifi/jwt/i18n/NiFiI18nResolver.java[NiFiI18nResolver] -- NiFi-specific resource bundle resolution
* link:../../nifi-cuioss-common/src/main/java/de/cuioss/nifi/jwt/i18n/I18nResolver.java[I18nResolver] -- Interface for internationalized message resolution
* link:../../nifi-cuioss-common/src/main/java/de/cuioss/nifi/jwt/JWTTranslationKeys.java[JWTTranslationKeys] -- Centralized translation key constants

=== Verification
* link:../../nifi-cuioss-common/src/test/java/de/cuioss/nifi/jwt/i18n/NiFiI18nResolverTest.java[NiFiI18nResolverTest]
* link:../../nifi-cuioss-processors/src/test/java/de/cuioss/nifi/processors/auth/MultiIssuerJWTTokenAuthenticatorI18nTest.java[MultiIssuerJWTTokenAuthenticatorI18nTest]

== I18n Framework Integration
_See Requirement link:../Requirements.adoc#NIFI-AUTH-17[NIFI-AUTH-17: Internationalization Support]_

=== NiFi I18n Framework

The processor integrates with NiFi's built-in internationalization framework using the link:../../nifi-cuioss-common/src/main/java/de/cuioss/nifi/jwt/i18n/I18nResolver.java[I18nResolver] API, implemented by link:../../nifi-cuioss-common/src/main/java/de/cuioss/nifi/jwt/i18n/NiFiI18nResolver.java[NiFiI18nResolver] for resource bundle loading and message resolution.

=== Resource Bundle Structure

Resource bundles follow the NiFi convention for processor internationalization:

[cols="1,2"]
|===
|File |Description

|nifi-cuioss-processors-resources.properties
|Default (English) messages

|nifi-cuioss-processors-resources_de.properties
|German translations
|===

These files are located in the standard NiFi location:
`src/main/resources/i18n/[bundlename].properties`

== Internationalized Components

=== Processor Properties
_See Requirement link:../Requirements.adoc#NIFI-AUTH-17[NIFI-AUTH-17: Internationalization Support]_

All processor properties (names, descriptions, etc.) are internationalized. See link:../../nifi-cuioss-processors/src/main/java/de/cuioss/nifi/processors/auth/MultiIssuerJWTTokenAuthenticator.java[MultiIssuerJWTTokenAuthenticator] for the property descriptor definitions using translated display names and descriptions.

For more details on property configuration, see link:configuration.adoc[Configuration].

=== Error Messages
_See Requirement link:../Requirements.adoc#NIFI-AUTH-17[NIFI-AUTH-17: Internationalization Support]_

All error messages are internationalized and consistently applied throughout the processor. See link:../../nifi-cuioss-processors/src/main/java/de/cuioss/nifi/processors/auth/MultiIssuerJWTTokenAuthenticator.java[MultiIssuerJWTTokenAuthenticator] for the error attribute handling using the I18nResolver.

For more details on error handling, see link:error-handling.adoc[Error Handling].

=== Log Messages
_See Requirement link:../Requirements.adoc#NIFI-AUTH-17[NIFI-AUTH-17: Internationalization Support]_

[NOTE]
====
Log messages (as defined in link:../LogMessages.adoc[LogMessages.adoc]) are not internationalized. They are always written in English for consistency in logs and monitoring systems.
====

The processor uses the CuiLogger implementation for structured logging. See link:../../nifi-cuioss-processors/src/main/java/de/cuioss/nifi/processors/auth/AuthLogMessages.java[AuthLogMessages] for the standardized log message definitions using `LogRecord` and `LogRecordModel`.

For more information about log message structure, see link:../LogMessages.adoc[Log Message Documentation].

=== Custom UI Components
_See Requirement link:../Requirements.adoc#NIFI-AUTH-17[NIFI-AUTH-17: Internationalization Support]_

Custom UI components like the Token Verification Interface also leverage NiFi's i18n support:

[source,javascript]
----
define(['jquery', 'nf.Common'], function ($, nfCommon) {
    return {
        init: function (element, processorId, callback) {
            // Get i18n resources from NiFi Common
            var i18n = nfCommon.getI18n();
            
            // Create UI elements with translated strings
            var tokenInput = $('<textarea class="token-input" placeholder="' + 
                              i18n['processor.jwt.tokenPlaceholder'] + '"></textarea>');
            var verifyButton = $('<button type="button" class="verify-token-button">' + 
                               i18n['processor.jwt.verifyButton'] + '</button>');
            
            // Rest of implementation...
        }
    };
});
----

For more details on UI implementation, see link:configuration-ui.adoc[UI Configuration].

== Resource Bundle Keys

=== Key Categories

Resource bundle keys are organized into logical categories for better maintainability:

1. **Property Descriptors**: Keys for processor property names and descriptions
2. **UI Components**: Keys for custom UI elements
3. **Error Messages**: Keys for error messages
4. **Validation Messages**: Keys for validation feedback
5. **Tooltips**: Keys for UI tooltips and help text

=== Key Naming Conventions

Resource keys follow these naming conventions:

* `property.[property-name].[attribute]` - For processor properties
* `processor.jwt.[element]` - For UI elements specific to the JWT processor
* `error.[category].[type]` - For error messages
* `validation.[field].[rule]` - For validation messages

== Example Resource Bundle Content

=== English (Default)

The English resource bundle includes base translations for all keys used in the processor:

[source,properties]
----
# Property descriptors
property.token.attribute.name=Token Attribute
property.token.attribute.description=The FlowFile attribute name containing the raw JWT token
property.require.valid.token.name=Require Valid Token
property.require.valid.token.description=Whether to require a valid token for processing

# Error messages
error.no.token.found=No token found in attribute: {0}
error.token.size.limit=Token exceeds maximum size limit of {0} bytes
error.token.malformed=Token is malformed (missing segments)

# UI components
processor.jwt.tokenInputPlaceholder=Paste token here...
processor.jwt.verifyToken=Verify Token
processor.jwt.tokenValid=Token is valid
----

=== German

The German resource bundle provides translations for German-speaking users:

[source,properties]
----
# Property descriptors
property.token.attribute.name=Token-Attribut
property.token.attribute.description=Der FlowFile-Attributname, der das rohe JWT-Token enthält
property.require.valid.token.name=Gültiges Token erforderlich
property.require.valid.token.description=Ob ein gültiges Token für die Verarbeitung erforderlich ist

# Error messages
error.no.token.found=Kein Token im Attribut gefunden: {0}
error.token.size.limit=Token überschreitet die maximale Größenbeschränkung von {0} Bytes
error.token.malformed=Token ist fehlerhaft formatiert (fehlende Segmente)

# UI components
processor.jwt.tokenInputPlaceholder=Token hier einfügen...
processor.jwt.verifyToken=Token verifizieren
processor.jwt.tokenValid=Token ist gültig
----

== Implementation Details

=== Locale Resolution

The processor uses NiFi's locale resolution approach:

1. Use the locale set in NiFi's user preferences (when available)
2. Fall back to the system default locale
3. Use English as the ultimate fallback

=== Message Formatting

For messages requiring parameter substitution, the processor uses the standard Java `MessageFormat` approach via link:../../nifi-cuioss-common/src/main/java/de/cuioss/nifi/jwt/i18n/NiFiI18nResolver.java[NiFiI18nResolver].

=== Key Management

To ensure all keys are properly maintained:

1. A centralized `JWTTranslationKeys` class defines all used key constants
2. Unit tests verify that all required keys exist in all bundles
3. Documentation lists all required keys for translators

== Testing Internationalization

=== Key Existence Testing

Resource bundle completeness is verified in link:../../nifi-cuioss-processors/src/test/java/de/cuioss/nifi/processors/auth/i18n/NiFiI18nResolverTest.java[NiFiI18nResolverTest] and link:../../nifi-cuioss-processors/src/test/java/de/cuioss/nifi/processors/auth/MultiIssuerJWTTokenAuthenticatorI18nTest.java[MultiIssuerJWTTokenAuthenticatorI18nTest].

=== UI Testing

UI internationalization is tested both programmatically and manually:

1. **Automated Tests**: Verify resource key resolution
2. **Manual Tests**: Visual verification with different locales
3. **Screenshot Comparison**: Automated screenshot comparison between locales

For more details on testing, see link:testing.adoc[Testing].

== Translation Workflow

=== Adding a New Language

To add support for a new language:

1. Create a new resource bundle file: `nifi-cuioss-processors-resources_[language-code].properties`
2. Translate all keys from the default bundle
3. Include the new bundle in the build process
4. Update documentation to mention the new supported language

=== Updating Translations

When adding new features:

1. Add new keys to the default (English) resource bundle
2. Add corresponding keys to all other language bundles
3. Run verification tests to ensure all bundles contain the required keys

== See Also

=== Core Documentation
* link:../Specification.adoc[Main Specification]
* link:../Requirements.adoc[Requirements]
* link:../Requirements.adoc#NIFI-AUTH-17[Internationalization Requirements]
* link:../LogMessages.adoc[Log Message Documentation]

=== Related Implementation
* link:configuration.adoc[Configuration]
* link:configuration-ui.adoc[UI Configuration]
* link:error-handling.adoc[Error Handling]
* link:testing.adoc[Testing]
