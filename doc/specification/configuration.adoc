= JWT Token Processor Configuration
:toc:
:toclevels: 3
:toc-title: Table of Contents
:sectnums:

link:../Specification.adoc[Back to Main Specification]

== Overview

This document details the configuration options for the JWT token validation processor in NiFi. It covers both UI-based configuration and static configuration for container environments.

== Configuration Properties
_See Requirement link:../Requirements.adoc#NIFI-AUTH-7[NIFI-AUTH-7: Configuration Requirements]_

=== Core Properties

The following core properties control the JWT token processor behavior:

[cols="2,1,1,2"]
|===
|Property |Type |Default |Description

|Token Header Name
|String
|Authorization
|Name of the header containing the JWT token

|JWKS Refresh Interval
|Time Period
|15 minutes
|How often to refresh the JWKS cache

|Require Valid Token
|Boolean
|true
|When true, only valid tokens result in success relationship

|Token Location
|String
|AUTHORIZATION_HEADER
|Where to find the token (AUTHORIZATION_HEADER, CUSTOM_HEADER, FLOW_FILE_CONTENT)

|Custom Header Name
|String
|null
|Name of custom header when Token Location is set to CUSTOM_HEADER
|===

=== Issuer Properties

Each issuer configuration supports the following properties:

[cols="1,3,1,1"]
|===
|Property |Description |Required |Default

|name
|A descriptive name for the issuer
|Yes
|N/A

|enabled
|Flag to enable or disable the issuer
|No
|true

|id
|Unique identifier for the issuer
|Yes
|N/A

|issuerUrl
|The URL of the token issuer, must match the 'iss' claim in the token
|Yes
|N/A

|jwksUrl
|URL to the JSON Web Key Set (JWKS) endpoint for retrieving public keys
|Yes
|N/A

|tokenExpiration
|Maximum allowed token lifetime in seconds
|No
|3600

|requiredClaims
|Comma-separated list of claims that must be present in the token
|No
|None

|claims
|Map of claim names and their expected values
|No
|None
|===

== Dynamic Properties
_See Requirement link:../Requirements.adoc#NIFI-AUTH-5.2[NIFI-AUTH-5.2: Dynamic Properties]_

Dynamic properties are used to configure token issuers. Each property represents a single issuer configuration.

[cols="2,1,2"]
|===
|Property |Type |Description

|Issuer Identifier
|String
|Value can be either a JWKS URL or a PEM-encoded public key
|===

== Configuration Examples

=== Basic Configuration
_See Requirement link:../Requirements.adoc#NIFI-AUTH-7.2[NIFI-AUTH-7.2: Token Validation Configuration]_

[source,properties]
----
# Static properties
Token Header Name: Authorization
JWKS Refresh Interval: 15 min
Require Valid Token: true
Token Location: AUTHORIZATION_HEADER

# Dynamic properties (issuers)
keycloak: https://auth.example.com/realms/master/protocol/openid-connect/certs
azure: https://login.microsoftonline.com/common/discovery/keys
----

=== Multi-Issuer Configuration with Custom Token Location
_See Requirement link:../Requirements.adoc#NIFI-AUTH-4[NIFI-AUTH-4: Multiple Issuer Support]_

[source,properties]
----
# Static properties
Token Header Name: Authorization
JWKS Refresh Interval: 30 min
Require Valid Token: true
Token Location: CUSTOM_HEADER
Custom Header Name: X-JWT-Token

# Dynamic properties (issuers)
internal-keycloak: https://auth.internal.example.com/realms/master/protocol/openid-connect/certs
customer-keycloak: https://auth.customer.example.com/realms/master/protocol/openid-connect/certs
partner-auth: https://auth.partner.example.com/.well-known/jwks.json
legacy-system: -----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA...
----

=== Content-Based Token Validation
_See Requirement link:../Requirements.adoc#NIFI-AUTH-5.1[NIFI-AUTH-5.1: Token Location]_

[source,properties]
----
# Static properties
Token Header Name: Authorization
JWKS Refresh Interval: 15 min
Require Valid Token: true
Token Location: FLOW_FILE_CONTENT

# Dynamic properties (issuers)
keycloak: https://auth.example.com/realms/master/protocol/openid-connect/certs
----

== Security Considerations

=== JWKS URL Security

1. JWKS URLs should use HTTPS to ensure secure key retrieval
2. Consider using mutual TLS authentication for JWKS endpoints in high-security environments
3. Implement proper network security controls to restrict access to JWKS endpoints

== See Also

* link:configuration-ui.adoc[UI Configuration]
* link:configuration-static.adoc[Static Configuration]
* link:token-validation.adoc[Token Validation]
* link:security.adoc[Security]
* link:technical-components.adoc[Technical Components]
* link:integration-patterns.adoc[Integration Patterns]
* link:../Requirements.adoc[Requirements]
* link:../Specification.adoc[Main Specification]