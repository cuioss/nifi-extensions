= MultiIssuerJWTTokenAuthenticator Configuration
:toc:
:toclevels: 3
:toc-title: Table of Contents
:sectnums:
:imagesdir: ../plantuml

link:../Specification.adoc[Back to Main Specification]

== Overview
[.requirement]
_See Requirement: link:../Requirements.adoc#NIFI-AUTH-7[NIFI-AUTH-7: Configuration Requirements]_

== Configuration Overview
[.requirement]
_See Requirement: link:../Requirements.adoc#NIFI-AUTH-7[NIFI-AUTH-7: Configuration Requirements]_

The MultiIssuerJWTTokenAuthenticator processor provides comprehensive configuration options for validating and processing JWT tokens. This document serves as the central reference for all configuration options.

=== Configuration Methods

The processor supports three configuration methods:

1. **UI Configuration** - Interactive configuration through the NiFi Web UI
2. **Static Configuration Files** - Configuration through properties, YAML, or JSON files
3. **Environment Variables** - Configuration through environment variables for containerized environments

== Configuration Properties

The processor provides the following configuration categories:

=== Core Properties
[.requirement]
_See Requirement: link:../Requirements.adoc#NIFI-AUTH-7.2[NIFI-AUTH-7.2: Core Properties]_

[cols="1,1,3,1"]
|===
|Property |Default |Description |Required

|Token Location
|AUTHORIZATION_HEADER
|Defines where to extract the token from (AUTHORIZATION_HEADER, CUSTOM_HEADER, FLOW_FILE_CONTENT)
|Yes

|Token Header
|Authorization
|The header name containing the token when using AUTHORIZATION_HEADER
|No

|Custom Header Name
|X-Authorization
|The custom header name when using CUSTOM_HEADER
|No

|Bearer Token Prefix
|Bearer
|The prefix to strip from the token (e.g., "Bearer ")
|No

|Require Valid Token
|true
|Whether to require a valid token for processing
|Yes
|===

=== Authorization Properties
[.requirement]
_See Requirement: link:../Requirements.adoc#NIFI-AUTH-9[NIFI-AUTH-9: Authorization Requirements]_

[cols="1,1,3,1"]
|===
|Property |Default |Description |Required

|Required Audience
|
|Audience string that must be included in the token audience claim
|No

|Required Scopes
|
|Comma-separated list of scopes required for authorization
|No

|Required Roles
|
|Comma-separated list of roles required for authorization
|No
|===

=== Performance Properties
[.requirement]
_See Requirement: link:../Requirements.adoc#NIFI-AUTH-10[NIFI-AUTH-10: Performance Requirements]_

[cols="1,1,3,1"]
|===
|Property |Default |Description |Required

|JWKS Refresh Interval
|3600
|Interval in seconds for refreshing JWKS keys
|Yes

|Maximum Token Size
|16384
|Maximum token size in bytes
|Yes
|===

=== Dynamic Properties (Issuers)
[.requirement]
_See Requirement: link:../Requirements.adoc#NIFI-AUTH-4[NIFI-AUTH-4: Multi-Issuer Support]_

The processor supports multiple issuers through dynamic properties:

[cols="1,3,1"]
|===
|Property |Description |Example

|<issuer-name>
|The JWKS URL or public key for the issuer
|https://auth.example.com/.well-known/jwks.json

|<issuer-name>.enabled
|Whether this issuer is enabled (true/false)
|true

|<issuer-name>.audience
|Override the required audience for this specific issuer
|api://my-service
|===

== Configuration Methods

=== UI Configuration

The processor provides a comprehensive user interface for configuration through the NiFi Web UI. UI Configuration includes:

* Core and advanced property configuration
* Dynamic issuer management
* JWKS endpoint verification
* Token validation testing

For detailed information about UI configuration, see link:configuration-ui.adoc[UI Configuration].

=== Static Configuration Files

For containerized environments and automated deployments, the processor supports configuration through external files in multiple formats:

* Properties (.properties)
* YAML (.yaml, .yml)
* JSON (.json)

Static configuration files can be placed in standard locations or specified through system properties and environment variables.

For detailed information about static file configuration, see link:configuration-static.adoc[Static Configuration].

=== Environment Variables

For container environments, configuration can also be provided through environment variables, making it suitable for Kubernetes, Docker, and other container orchestration platforms.

The configuration precedence order is:
1. Static configuration files
2. Environment variables
3. UI configuration

For detailed information about environment variable configuration, see link:configuration-static.adoc#environment-variable-configuration[Environment Variable Configuration].

== Common Configuration Scenarios

=== Basic Configuration with Single Issuer

[source,properties]
----
# Static properties
Token Location=AUTHORIZATION_HEADER
Token Header=Authorization
Bearer Token Prefix=Bearer
Require Valid Token=true
Required Audience=api://my-service
JWKS Refresh Interval=3600

# Dynamic properties (issuers)
auth-server=https://auth-server.example.com/.well-known/jwks.json
----

=== Advanced Configuration with Multiple Issuers

[source,properties]
----
# Static properties
Token Location=AUTHORIZATION_HEADER
Token Header=Authorization
Bearer Token Prefix=Bearer
Require Valid Token=true
Required Scopes=read,write
JWKS Refresh Interval=1800

# Dynamic properties (issuers)
auth-server-production=https://auth.example.com/.well-known/jwks.json
auth-server-production.audience=api://my-service-prod

auth-server-testing=https://auth-test.example.com/.well-known/jwks.json
auth-server-testing.audience=api://my-service-test
auth-server-testing.enabled=false  # Disabled in production
----

== Related Topics

* link:configuration-ui.adoc[UI Configuration] - Details on configuring the processor through the NiFi UI
* link:configuration-static.adoc[Static Configuration] - Configuration for container environments
* link:token-validation.adoc[Token Validation] - How tokens are validated using the configuration
* link:error-handling.adoc[Error Handling] - Handling configuration errors
* link:technical-components.adoc[Technical Components] - Implementation details