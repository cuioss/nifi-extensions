@startuml component-interaction
!pragma layout smetana

skinparam componentStyle rectangle
skinparam monochrome true
skinparam shadowing false
skinparam defaultFontName "Arial"
skinparam ArrowColor black
skinparam ArrowThickness 1.5

title "Component Interaction Diagram - NiFi Extensions"

cloud "External Services" {
  [Identity Provider] as IDP
}

package "Apache NiFi" {
  [NiFi Core] as NiFiCore

  package "CUI OSS Extensions" {
    [MultiIssuerJWTToken\nAuthenticator] as MultiIssuer
    [JWTToken\nAuthenticator] as SimpleAuth
    [ConfigurationManager] as ConfigManager
    [IssuerConfigurationParser] as ConfigParser
    [ErrorContext] as ErrorContext
  }
}

package "OAuth-Sheriff" {
  [TokenValidator] as TokenValidator
}

database "Properties Repository" as PropsRepo

NiFiCore ..> [CUI OSS Extensions] : uses
MultiIssuer --> TokenValidator : validates tokens
SimpleAuth --> TokenValidator : validates tokens
TokenValidator --> IDP : retrieves JWKS keys
MultiIssuer --> ConfigManager : reads configuration
SimpleAuth --> ConfigManager : reads configuration
ConfigManager --> ConfigParser : parses issuer configs
ConfigManager --> PropsRepo : loads/stores configs
MultiIssuer --> ErrorContext : captures errors
SimpleAuth --> ErrorContext : captures errors

note right of MultiIssuer: Full JWT validation with\nmulti-issuer support
note right of SimpleAuth: Simple token extraction\nand validation
note bottom of ConfigManager: Provides centralized\nconfiguration management
@enduml
