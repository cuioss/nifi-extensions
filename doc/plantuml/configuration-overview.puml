@startuml configuration-overview
!pragma layout smetana
skinparam backgroundColor white
skinparam componentStyle rectangle
skinparam defaultTextAlignment center

title NiFi Extensions Configuration Overview

package "Configuration Sources" as sources {
  [UI Configuration] as ui
  [Static Config Files] as files
  [Environment Variables] as env
}

package "Controller Service\n(JwtIssuerConfigService)" as cs_config {
  [Issuer Configuration\n(dynamic properties)] as issuers
  [JWKS Settings\n(refresh, timeout, HTTPS)] as jwks_settings
  [Token Validation\n(size, algorithms)] as token_settings
}

package "MultiIssuerJWTTokenAuthenticator\nProcessor Properties" as jwt_config {
  [Token Attribute Name] as token_attr
  [Require Valid Token] as require_token
  [Required Roles / Scopes] as jwt_authz
  [CS Reference] as jwt_cs_ref
}

package "RestApiGatewayProcessor\nProperties" as gw_config {
  [Listening Port / Host] as listen
  [SSL Context Service] as ssl
  [Max Request Size / Queue] as limits
  [CORS Allowed Origins] as cors
  [Management API Key] as mgmt_key
  [CS Reference] as gw_cs_ref
  [Route Configuration\n(dynamic properties)] as routes
}

ui --> cs_config : provides
files --> cs_config : provides
env --> cs_config : provides

jwt_cs_ref --> cs_config : references
gw_cs_ref --> cs_config : references

note bottom of sources
  Precedence:
  1. Static Config Files
  2. Environment Variables
  3. UI Configuration
end note

note right of routes
  Dynamic property DSL:
  restapi.<name>.path
  restapi.<name>.methods
  restapi.<name>.required-roles
  restapi.<name>.required-scopes
end note

note right of issuers
  Each issuer has:
  - JWKS URL
  - Audience
  - Roles
  - Scopes
end note

@enduml
