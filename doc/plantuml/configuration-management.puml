@startuml configuration-management
!pragma layout smetana
skinparam defaultTextAlignment center
skinparam componentStyle uml2

title "JWT Processor Configuration Management Flow"

package "Processor Configuration" {
  [NiFi Property Descriptor] as properties
  [IssuerConfigurationParser] as configParser
  [ConfigurationManager] as configManager
}

package "Configuration Storage" {
  database "Issuer Configurations" as issuerConfigs {
    [Issuer 1 Config] as config1
    [Issuer 2 Config] as config2
    [Issuer 3 Config] as config3
  }
}

package "OAuth-Sheriff" {
  [TokenValidator] as tokenValidator
  [HttpJwksLoaderConfig] as jwksLoader
}

package "External Resources" {
  [JWKS Endpoint 1] as jwks1
  [JWKS Endpoint 2] as jwks2
  [JWKS Endpoint 3] as jwks3
}

' Relationships
properties --> configParser : provides raw config
configParser --> configManager : parsed configurations
configManager --> issuerConfigs : stores valid configs
tokenValidator --> issuerConfigs : uses
jwksLoader --> issuerConfigs : configured from

config1 --> jwks1 : fetches keys from
config2 --> jwks2 : fetches keys from
config3 --> jwks3 : fetches keys from

note right of properties
  Configuration properties:
  - Issuer URLs
  - Required claims
  - Audience values
  - Cache settings
end note

note bottom of configManager
  Manages:
  - Configuration lifecycle
  - Validation of settings
  - Issuer registration
end note

note right of jwksLoader
  Controls:
  - JWKS key loading
  - Key caching
  - Key rotation
end note

@enduml
