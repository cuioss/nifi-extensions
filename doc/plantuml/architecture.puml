@startuml
!pragma layout smetana
package "NiFi Framework" {
  [NiFi Core] as NiFiCore
  [Processor API] as ProcessorAPI
}

package "NiFi CUI OSS Processors" {
  [MultiIssuerJWTToken\nAuthenticator] as MultiIssuer
  [JWTToken\nAuthenticator] as SimpleAuth
  [ConfigurationManager] as ConfigManager
  [ErrorContext] as ErrorContext
}

package "OAuth-Sheriff" {
  [TokenValidator] as TokenValidator
  [HttpJwksLoaderConfig] as JwksLoader
  [AccessTokenContent] as TokenContent
}

package "External Services" {
  [Identity Provider 1] as IDP1
  [Identity Provider 2] as IDP2
}

NiFiCore --> ProcessorAPI : uses
ProcessorAPI --> MultiIssuer : extends
ProcessorAPI --> SimpleAuth : extends

MultiIssuer --> ConfigManager : reads configuration
MultiIssuer --> TokenValidator : validates tokens
MultiIssuer --> ErrorContext : captures errors

SimpleAuth --> TokenValidator : validates tokens
SimpleAuth --> ErrorContext : captures errors

TokenValidator --> JwksLoader : retrieves keys
TokenValidator --> TokenContent : returns result

JwksLoader --> IDP1 : retrieves JWKS
JwksLoader --> IDP2 : retrieves JWKS
@enduml
