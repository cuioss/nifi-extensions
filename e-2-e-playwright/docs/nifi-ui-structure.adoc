= NiFi UI Structure Guide
:toc: left
:toclevels: 3
:toc-title: Table of Contents
:sectnums:
:source-highlighter: highlight.js

Reference for NiFi UI structure, selectors, and authentication flow used in E2E testing.

== NiFi Version

*Current Version*: Apache NiFi (Angular Material UI)

*UI Sources*: https://github.com/apache/nifi/tree/main/nifi-web/nifi-web-frontend

== Authentication Flow

=== API Token Authentication

[source,text]
----
POST /nifi-api/access/token
Content-Type: application/x-www-form-urlencoded
Body: username=testUser&password=drowssap

→ HTTP 201 Created
→ Set-Cookie: __Secure-Authorization-Bearer=[JWT-Token]
→ Response: [JWT Token Body]

GET /nifi-api/flow/current-user
Cookie: __Secure-Authorization-Bearer=[JWT-Token]
----

=== CSRF Token

NiFi requires a CSRF token for API authentication:

* Cookie name: `__Secure-Request-Token`
* Header name: `Request-Token`

== Page Detection

NiFi uses URL hash patterns for routing:

[cols="1,2"]
|===
|Pattern |Page Type

|`/#/process-groups/{id}`
|Main canvas

|`/#/canvas`
|Alternative canvas pattern

|`/#/login`
|Login page
|===

== Canvas Structure

From NiFi source (`flow-designer/ui/canvas/canvas.component.html`):

[source,html]
----
<mat-sidenav-content>
  <graph-controls></graph-controls>
  <div id="canvas-container"
       class="canvas-background select-none h-full w-full">
    <!-- D3.js canvas content rendered here -->
  </div>
</mat-sidenav-content>
----

== Selectors Reference

=== Canvas

[cols="1,2"]
|===
|Selector |Description

|`#canvas-container`
|Primary canvas container

|`mat-sidenav-content`
|Angular Material sidenav wrapper

|`mat-sidenav-container`
|Full sidenav layout
|===

=== Processors

Processors are rendered as SVG elements within the canvas:

[cols="1,2"]
|===
|Selector |Description

|`svg g[class*="processor"]`
|Processor group elements

|`.component`
|Generic flow component
|===

=== Configuration Dialog

Processor configuration uses Angular Material dialogs:

[source,html]
----
<mat-dialog-container>
  <mat-tab-group>
    <mat-tab label="Settings">...</mat-tab>
    <mat-tab label="Properties">...</mat-tab>
    <mat-tab label="Relationships">...</mat-tab>
    <mat-tab label="Comments">...</mat-tab>
  </mat-tab-group>
</mat-dialog-container>
----

[cols="1,2"]
|===
|Selector |Description

|`mat-dialog-container`
|Configuration dialog wrapper

|`mat-tab-group`
|Tab navigation within dialog

|`mat-form-field input`
|Property input fields

|`button[mat-button]`
|Material Design buttons
|===

=== Selector Strategy

Prefer selectors in this priority order:

1. `data-testid` attributes (most stable)
2. Angular Material component selectors (`mat-dialog-container`, `mat-tab`)
3. ARIA attributes (`[role="dialog"]`, `[aria-label="..."]`)
4. CSS class selectors (least stable, use as fallback)

== Infrastructure

=== Service URLs

[cols="1,2"]
|===
|Service |URL

|NiFi UI
|`https://localhost:9095/nifi/`

|NiFi API
|`https://localhost:9095/nifi-api/`

|Keycloak
|`http://localhost:9080`
|===

== Related Documentation

* xref:../README.adoc[E2E Playwright Tests] — Main module documentation
* xref:implementation-guide.adoc[Implementation Guide] — Test architecture and patterns
* xref:processor-api-manager-guide.adoc[Processor API Manager Guide] — REST API-based processor management
