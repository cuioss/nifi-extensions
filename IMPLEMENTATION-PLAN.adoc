= Implementation Plan: NiFi JWT Authenticator Missing Features
:toc: left
:toclevels: 3
:toc-title: Table of Contents
:sectnums:
:source-highlighter: highlight.js

== Overview

This document outlines the implementation plan for completing the NiFi JWT Authenticator.

Last updated: 2025-07-25

=== Current Status

* ✅ *Phase 0*: Test Infrastructure - COMPLETED
* ✅ *Phase 1*: Core Functionality - COMPLETED (except YAML support - removed from scope)
* ❌ *Phase 2*: UI Enhancement - NOT STARTED
* ❌ *Phase 3*: Observability - NOT STARTED
* ❌ *Phase 4*: Advanced Features - NOT STARTED
* ❌ *Phase 5*: Documentation & Polish - NOT STARTED

=== Completed Tasks

* Test infrastructure fixed (DynamicPropertyTestHelper)
* Authorization implementation (scope/role validation)
* Flow file attributes (jwt.scopes, jwt.roles, jwt.authorized)
* All 62 processor tests passing

== Remaining Tasks

=== Phase 2: UI Enhancement (P2)

==== 2.1 Custom UI Components
* [ ] Create `MultiIssuerJwtAuthenticatorCustomizer.js`
* [ ] Implement JWKS Validation Button
* [ ] Add Token Verification Tab
* [ ] Add Metrics Tab
* [ ] Add Help Tab

==== 2.2 REST Endpoint
* [ ] Create `/api/token/verify` endpoint
* [ ] Implement token verification logic
* [ ] Add security controls

==== 2.3 JWKS Validation
* [ ] Add URL validation for JWKS endpoints
* [ ] Add file existence validation
* [ ] Implement validation button backend

=== Phase 3: Observability (P2)

==== 3.1 Metrics Implementation
* [ ] Create `NifiSecurityEventRegistry` class
* [ ] Bridge SecurityEventCounter to NiFi metrics
* [ ] Implement Prometheus formatting
* [ ] Add metrics endpoints

==== 3.2 UI Metrics Display
* [ ] Display validation success/failure rates
* [ ] Show issuer-specific metrics
* [ ] Add real-time updates

==== 3.3 Monitoring Templates
* [ ] Create JWT validation dashboard
* [ ] Add issuer-specific panels
* [ ] Create alert rules

=== Phase 4: Advanced Features (P3)

==== 4.1 Advanced cui-jwt-validation Integration
* [ ] Replace direct JWKS loading with JwksLoader
* [ ] Implement JwksLoaderFactory usage
* [ ] Add HttpJwksLoaderConfig support

==== 4.2 Integration Testing
* [ ] Create Docker Compose setup
* [ ] Add Keycloak integration
* [ ] Implement integration test suite
* [ ] Fix broken link in integration-testing/README.adoc:186

==== 4.3 E2E Test Completion
* [ ] Implement issuer configuration tests
* [ ] Add token verification flow tests
* [ ] Create JWKS validation tests
* [ ] Add metrics verification tests

=== Phase 5: Documentation & Polish (P4)

==== 5.1 Internationalization
* [ ] Complete all German translations
* [ ] Add I18nKeys constants class
* [ ] Create i18n completeness tests

==== 5.2 Integration Patterns
* [ ] Create API Gateway pattern example
* [ ] Add service-to-service auth example
* [ ] Create multi-tenant routing example

==== 5.3 Security Hardening
* [ ] Add algorithm whitelist configuration
* [ ] Implement algorithm validation
* [ ] Add security configuration options

==== 5.4 Build Configuration
* [ ] Resolve Maven enforcer workaround in nifi-cuioss-nar/pom.xml:31
* [ ] Remove `<enforcer.skip>true</enforcer.skip>` if possible

== Implementation Order

1. Phase 2 (UI Enhancement)
2. Phase 3 (Observability)
3. Phase 4 (Advanced Features)
4. Phase 5 (Documentation & Polish)

== Success Criteria

1. All P1 features implemented and tested
2. Authorization checking functional for all issuers
3. Custom UI providing enhanced user experience
4. Metrics collection and monitoring operational
5. 80%+ test coverage for new code
6. Documentation complete and up-to-date